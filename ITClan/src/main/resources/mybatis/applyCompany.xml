<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="applycompany">
		
	<insert id="create" parameterType="ApplyCompanyDTO">
	<selectKey order="BEFORE" keyProperty="applyCode" resultType="int">
	SELECT NVL(MAX(applyCode), 0) + 1 as applyCode FROM applycompany
	</selectKey>
	insert into applycompany(applyCode,memberID,applydate,offerNum,resumeNum,portfolioNum)
	values(#{applyCode},#{memberID},sysdate,#{offerNum},#{resumeNum},#{portfolioNum})
	
	</insert>
	
	
	<select id="memberIDCheck" resultType="int" parameterType="Map">
	select count(*) from applycompany
	where memberID =#{memberID} and offerNum =#{offerNum} 
	</select>
	<delete id="delete_personal" parameterType="String">
	delete from applycompany
	where memberID =#{memberID} and offerNum =#{offerNum} 
	</delete>
	<delete id="delete_personalA" parameterType="String">
	delete from applycompany
	where memberID =#{memberID}
	</delete>
	
	<select id="read_personal" parameterType="int" resultType="OfferDTO">
	select * from offer
	where offerNum = #{offerNum}
	</select>
	<select id="total_personal" parameterType="String" resultType="int">
		select count(*)
		from applycompany a, offer o
		where a.offerNum = o.offerNum
		and a.memberID = #{memberID}
	</select>
<resultMap type="ApplyCompanyDTO" id="PersonalMap">
<result property="applyCode" column="applyCode"/>
<result property="applyDate" column="applyDate"/>
<result property="memberID" column="memberID"/>
<result property="offerNum" column="offerNum"/>
<result property="resumeNum" column="resumeNum"/>
<result property="portfolioNum" column="portfolioNum"/>
<result property="viewCheck" column="viewCheck"/>
<collection property="offerList" column="offerNum" javaType="List" ofType="OfferDTO"
 resultMap="applycompany.OfferDTOListMap"/>
</resultMap>
<resultMap type="OfferDTO" id="OfferDTOListMap">
<result property="offerNum" column="offerNum"/>
<result property="title" column="title"/>
<result property="companyName" column="companyName"/>
<result property="recruitment" column="recruitment"/>
</resultMap>


<resultMap type="PersonalMemberDTO" id="CompanyMap">
<result property="name" column="name"/>
<result property="memberID" column="memberID"/>
<result property="birth" column="birth"/>
<result property="phone" column="phone"/>
<result property="address" column="address"/>
<result property="address2" column="address2"/>
<result property="email" column="email"/>
<collection property="resumeInfoList" column="memberID" javaType="List" ofType="ResumeInfoDTO"
 resultMap="applycompany.ResumeInfoDTOListMap"/>
</resultMap>

<resultMap type="ResumeInfoDTO" id="ResumeInfoDTOListMap">
<result property="memberID" column="memberID"/>
<result property="education" column="education"/>
<result property="career" column="career"/>
<result property="employmentType" column="employmenttype"/>
<result property="exSalary" column="exsalary"/>
<result property="disableGrade" column="disablegrade"/>
<result property="picture" column="picture"/>
<result property="exArea" column="exarea"/>
<result property="exField" column="exfield"/>
<result property="military" column="military"/>
<result property="schoolName" column="schoolName"/>
<result property="major" column="major"/>
<result property="termtime" column="termtime"/>
<result property="GPA" column="GPA"/>
</resultMap>
<resultMap type="PersonalMemberDTO" id="PersonalMemberDTOListMap">
<result property="memberID" column="memberID"/>
<result property="name" column="name"/>
</resultMap>
<select id="read_c">
	select  name,memberID,birth,phone,address,address2,email,education,
		career,employmenttype,exsalary,disablegrade,picture,shoolName,major,termtime,GPA,
	exarea,exfield,military,resumeName,portfolioName
	from(
	select p.name,r.memberID,p.birth,p.phone,p.address,p.address2,p.email, r.education,
		r.career,r.employmenttype,r.exsalary,r.disablegrade,r.picture,r.shoolName,r.major,r.termtime,r.GPA,
	r.exarea,r.exfield,r.military,re.resumeName,pf.portfolioName
	from resumeinfo r ,applycompany a ,personalmember p , offer o ,resume re , portfolio pf
	where p.memberID = r.memberID and r.memberID = a.memberID
	and p.memberID = re.memberID and p.memberID = pf.memberID 
	and o.offerNum = a.offerNum
	)
	where memberID = 'bbb' and offerNum = 2 and resumeNum =4 and portfolioNum = 4
</select>


	<select id="list_personal" parameterType="Map" resultMap = "PersonalMap">
		select applydate , memberID,offerNum , title,companyName,recruitment,
		r
		from(
		select applydate , memberID,offerNum , title,companyName,recruitment,rownum
		r
		from(
		select a.applydate , a.memberID,a.offerNum ,
		o.title,o.companyName,o.recruitment
		from applycompany a,offer o
		where o.offerNum = a.offerNum
		and a.memberID=#{memberID}
		)
		)
	<![CDATA[
	where r >=#{sno} and r<=#{eno}
	]]>
	</select>
<select id="list_company" parameterType="Map" resultMap="manyMap">
 select memberID,name,applydate,r	
 	from(
 	select memberID , name, applydate ,rownum r
 	from(
 	select a.memberID, p.name , a.applydate
	from Personalmember p , applycompany a
	where p.memberID = a.memberID and offerNum = #{offerNum}
	order by a.applydate asc
	)
	)
	<![CDATA[
	where r >=#{sno} and r<=#{eno}
	]]>
</select>
	
	<update id="viewup" parameterType="int">
	update applycompany
	set
	viewCheck = viewCheck + 1
	where viewCheck = 0 and offerNum = #{offerNum} and memberID = #{memberID}
	</update>
	
<select id="viewCheck">
select viewCheck from applycompany
where offerNum = #{offerNum} and memberID = #{memberID}
</select>
	
		<select id="total_company" parameterType="int" resultType="int">
	 select count(*) 
 from applycompany a , offer o 
 where a.offerNum = o.offerNum
 and a.offerNum = #{offerNum}
	
	</select>
	
	<delete id="delete_company">
	delete from applycompany
where offerNum =#{offerNum}
	</delete>
	<!-- resumedetail (list/read) -->
	<select id="down_resume" parameterType="Map" resultType="String" >
	select resumeName from resume
	where memberID = #{memberID} and resumenum = #{resumenum}
	</select>
	<select id="list_resume" parameterType="String" resultType="ResumeDTO">
	select resumeNum,memberID ,resumeName from resume
	where memberID=#{memberID}
	</select>
	
	
	<select id="down_portfolio" parameterType="Map" resultType="String" >
	select portfolioName from PortFolio
	where memberID = #{memberID} and portfolioNum = #{portfolioNum}
	</select>
	<select id="list_portfolio" parameterType="String" resultType="PortFolioDTO">
	select portfolioNum , memberID, portfolioName 
	from portfolio
	where memberID = #{memberID}
	</select>
	
	
	<select id="list_License" parameterType="String" resultType="LicenseDTO" >
	select * from license
where memberID = #{memberID}
	</select>
	<select id="list_externalactivity" parameterType="String" resultType="externalactivityDTO" >
	select * from externalactivity
where memberID = #{memberID}
	</select>
	
</mapper>