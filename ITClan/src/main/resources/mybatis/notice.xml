<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="notice">

	<insert id="create" parameterType="NoticeDTO">
		insert into notice(noticeNum,title,content,regDate)
		values( (SELECT NVL(MAX(noticeNum), 0) + 1 as noticeNum FROM notice), #{title}, #{content},sysDate )
	</insert>

	<update id="update" parameterType="NoticeDTO">
	    update notice
	    set title=#{title}, content=#{content}
		where noticeNum = #{noticeNum}
	</update>
	
	<select id="read" resultType="NoticeDTO" parameterType="int">
	  select noticeNum, title, content,regDate,viewCnt
	  from notice
	  where noticeNum = #{noticeNum}
	</select>

	<delete id="delete" parameterType="int">
		delete from notice
		where noticeNum = #{noticeNum}
	</delete>

	<select id="list" resultType="NoticeDTO" parameterType="Map">
	select  noticeNum , title, content, viewCnt, regDate, r
		from(
			select  noticeNum , title, content, viewCnt, regDate, rowNum r
			from(
				select noticeNum, title, content, viewCnt, regDate 
				from notice  
		<where>
			<choose>
				<when test="col=='title'">
					title like '%'||#{word}||'%'
				</when>
				<when test="col=='content'">
					content like '%'||#{word}||'%'
				</when>
			</choose>
		</where>        	                                       
			ORDER BY noticeNum DESC
			)
			)                                                                            
	   <![CDATA[                                                                        
	   where r>=#{sno} and r<=#{eno}  
	   ]]>
	</select>
	
	<select id="total" parameterType="Map" resultType="int">
		select count(*) from notice
	</select>
	
	<update id="viewcnt" parameterType="int">
	UPDATE notice
	SET viewCnt = viewCnt +1
	WHERE noticeNum = #{noticeNum}
	</update>
</mapper>